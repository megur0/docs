[TOP(About this memo))](../README.md) > [一覧(iOSアプリ開発)](./README.md) > その他(未整理)



# WIP
* このメモは作成中
* 取り急ぎ、分散した知識をここに追記していき、後ほど整理する。

# ユーザーに許可の設定状態の確認
## Appのバックグラウンド更新
* iOS7から利用できるようになった
* デフォルトでは有効だがユーザーが設定で無効化できる。
* UIApplication.sharedApplication.backgroundRefreshStatus から有効・無効状態を参照できる
## 通知
* 設定 > 対象のアプリ > 通知 以下の設定状況に該当する設定状況
* UNUserNotificationCenter.current().notificationSettings() から参照できる


# App Tracking Transparency（ATT）
* https://developer.apple.com/jp/app-store/user-privacy-and-data-use/
> iOS 14.5、iPadOS 14.5、tvOS 14.5以降では、ユーザーをトラッキングしたり、ユーザーのデバイスの広告識別子にアクセスしたりする際には、AppTrackingTransparency（ATT）のフレームワークを通じてユーザーの許可を得る必要があります。

> トラッキングを有効にする許可をユーザーから得ない限り、デバイスの広告識別子の値はすべてゼロになります。

> ユーザーがアプリからのトラッキングのリクエストを許可したものの、アプリ上でトラッキング設定を無効にしている場合、「設定」へのショートカットを提供することで、当該アプリのトラッキング設定を変更するよう求めることができます。

* 対価によってユーザーに許可されるようなアプリの振る舞いはガイドライン違反となる。
* ただし、トラッキングの許可を求める前に、トラッキングを許可してほしい旨をユーザーに説明することは許容範囲とされている。
* ATTの仕組みによる許可を得ずに、ユーザーをIDFA以外の手段(ハッシュ化されたEmailなど)でトラッキングすることは禁止されている。
* 個別のデバイスを特定する目的で(IDFA以外で)デバイスからデータを取得することは許容されない
    > ユーザーやデバイスのデータには、ユーザーのWebブラウザのプロパティと設定、ユーザーのデバイスとその設定、ユーザーの位置情報、ユーザーのネットワーク接続情報が含まれますが、これらに限定されません。このような行為に関与していることが明らかになったアプリ、またはそのようなSDK（広告ネットワーク、アトリビューションサービスやアナリティクスが含まれるが、これらに限定されない）を参照しているアプリは、App Storeから却下される可能性があります。
* (IMO) ATTによる許可を得ている際に、IDFAではなくEmail等の情報でユーザーをトラッキングすることはガイドライン上は良いのか?
    * できないと解釈した方が良い、と筆者は考えている。

# SKAdNetwork
* https://developer.apple.com/documentation/storekit/skadnetwork/
    > 広告ネットワーク API は、ユーザーのプライバシーを維持しながら広告主が広告キャンペーンの成功を測定するのに役立ちます。API には次の 3 つの参加者が関与します。  

    > 広告に署名し、広告がコンバージョンにつながった後にインストール検証ポストバックを受け取る広告ネットワーク
    
    > 広告ネットワークからの広告を表示するアプリ、またはSafariで広告を表示するウェブサイト
    
    > ユーザーがアプリを利用するとコンバージョン値が更新される広告アプリ
* SK: AppleのStoreKit（ストアキット）
    * Apppleがデベロッパー向けに定めた規格
* 広告に関するデータをデバイスからサードパーティへ送信するためのAPIとなる。
* SKAdNetworkはATTによるユーザーの許可がなくとも利用可能となる。もちろんATTが承認されていない場合にIDFD
    > Apple は、ユーザーのプライバシーを維持するように SKAdNetwork API を設計しています。アプリは、SKAdNetwork API を呼び出す前にApp Tracking Transparencyを使用する必要はなく、追跡承認ステータスに関係なくこれらの API を呼び出すことができます。
* 利用にするにはInfo.plistへAppleから広告主に発行された広告ネットワークID を設定する必要がある。
* Googleの説明
    * https://support.google.com/admob/answer/9997589?hl=ja
    > 広告主は、広告キャンペーンの成果とお客様のアプリへの広告掲載によって得られる価値を、Apple の SKAdNetwork API を使って測定します。お客様のアプリが広告トラフィックにつながる価値の高いソースであると認識してもらうには、SKAdNetwork で Google のネットワーク キーを設定する必要があります。


